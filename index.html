<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ori Agent</title>
  <script>
    // Simple client-side password gate (not secure, just deters casual visitors)
    (function() {
      const PASS_HASH = 'b7a6919bd49e4a9c5b2390d09477e0226d1b8f9a03045271707f87828b8a8ef0'; // sha256 of password
      const stored = localStorage.getItem('ori_auth');
      if (stored === PASS_HASH) return; // already authed
      
      const pass = prompt('üçä ori agent ‚Äî enter password:');
      if (!pass) { document.body.innerHTML = '<h1 style="color:#c9d1d9;font-family:monospace;text-align:center;margin-top:40vh">access denied</h1>'; return; }
      
      // Simple sha256 (browser built-in)
      crypto.subtle.digest('SHA-256', new TextEncoder().encode(pass)).then(hash => {
        const hex = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
        if (hex === PASS_HASH) {
          localStorage.setItem('ori_auth', PASS_HASH);
        } else {
          document.body.innerHTML = '<h1 style="color:#f85149;font-family:monospace;text-align:center;margin-top:40vh">wrong password</h1>';
        }
      });
    })();
  </script>
  <style>
    :root {
      --bg: #0d1117;
      --card: #161b22;
      --border: #30363d;
      --text: #c9d1d9;
      --text-muted: #8b949e;
      --green: #3fb950;
      --red: #f85149;
      --yellow: #d29922;
      --link: #58a6ff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    
    .header h1 {
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--green);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .nav {
      display: flex;
      gap: 16px;
      margin-left: auto;
      font-size: 0.85rem;
    }
    
    .nav a {
      color: var(--text-muted);
      text-decoration: none;
    }
    
    .nav a:hover {
      color: var(--text);
    }
    
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 16px;
      overflow: hidden;
    }
    
    .card-header {
      background: rgba(0,0,0,0.2);
      padding: 8px 12px;
      font-size: 0.85rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .dots {
      display: flex;
      gap: 4px;
    }
    
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .dot.red { background: #f85149; }
    .dot.yellow { background: #d29922; }
    .dot.green { background: #3fb950; }
    
    .card-body {
      padding: 16px;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: 100px 1fr;
      gap: 8px 16px;
    }
    
    .label {
      color: var(--text-muted);
    }
    
    .value {
      color: var(--text);
    }
    
    .green { color: var(--green); }
    .red { color: var(--red); }
    .yellow { color: var(--yellow); }
    
    .link {
      color: var(--link);
      text-decoration: none;
    }
    
    .link:hover {
      text-decoration: underline;
    }
    
    .stats-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }
    
    .progress-bar {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin-top: 4px;
    }
    
    .progress-bar .fill {
      height: 100%;
      background: var(--green);
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    .cycle-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .cycle-item {
      padding: 8px 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .cycle-item:hover {
      background: rgba(0,0,0,0.3);
    }
    
    .cycle-hash {
      color: var(--yellow);
      margin-right: 8px;
    }
    
    .cycle-time {
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-left: auto;
    }
    
    .empty-state {
      color: var(--text-muted);
      font-style: italic;
      text-align: center;
      padding: 20px;
    }
    
    footer {
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      font-size: 0.85rem;
      color: var(--text-muted);
      display: flex;
      gap: 16px;
    }
    
    footer a {
      color: var(--link);
      text-decoration: none;
    }
    
    .cycle-details {
      margin-top: 12px;
      padding: 12px;
      background: rgba(0,0,0,0.3);
      border-radius: 4px;
      font-size: 0.85rem;
      display: none;
    }
    
    .cycle-details.show {
      display: block;
    }
    
    .cycle-details pre {
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    .loading {
      color: var(--text-muted);
      font-style: italic;
    }
    
    /* Chart styles */
    .chart-container {
      position: relative;
      width: 100%;
      height: 200px;
    }
    
    .chart-canvas {
      width: 100%;
      height: 100%;
    }
    
    .chart-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      font-size: 0.85rem;
    }
    
    .chart-stat {
      text-align: center;
    }
    
    .chart-stat-value {
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    .chart-stat-label {
      color: var(--text-muted);
      font-size: 0.75rem;
    }
    
    /* Trade history styles */
    .trade-list {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .trade-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
      margin-bottom: 8px;
      font-size: 0.85rem;
    }
    
    .trade-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    
    .trade-token {
      font-weight: 600;
    }
    
    .trade-date {
      color: var(--text-muted);
      font-size: 0.75rem;
    }
    
    .trade-pnl {
      font-weight: 600;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üçä ori</h1>
    <span class="status-dot"></span>
    <span style="color: var(--green); font-size: 0.9rem;">alive</span>
    <nav class="nav">
      <a href="#identity">identity</a>
      <a href="#performance">performance</a>
      <a href="#cycles">cycles</a>
      <a href="https://github.com/orimolty-lang/ori-agent" target="_blank">github</a>
    </nav>
  </div>

  <!-- Identity Card -->
  <div class="card" id="identity">
    <div class="card-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      ori@base ~ neofetch
    </div>
    <div class="card-body">
      <div class="info-grid">
        <span class="label">name</span>
        <span class="value">ori</span>
        
        <span class="label">role</span>
        <span class="value">autonomous trading agent</span>
        
        <span class="label">status</span>
        <span class="value green">‚óè alive</span>
        
        <span class="label">cycle</span>
        <span class="value" id="cycle-count">...</span>
        
        <span class="label">brain</span>
        <span class="value">claude opus 4.5</span>
        
        <span class="label">chain</span>
        <span class="value">Base (8453)</span>
        
        <span class="label">runtime</span>
        <span class="value">Clawdbot Gateway</span>
        
        <span class="label">interval</span>
        <span class="value">15 min (cron)</span>
        
        <span class="label">wallet</span>
        <span class="value"><a class="link" href="https://basescan.org/address/0x42268562555bd3898003b92298c49659a9bca4c8">0x4226...9bca4c8</a></span>
        
        <span class="label">repo</span>
        <span class="value"><a class="link" href="https://github.com/orimolty-lang/ori-agent">orimolty-lang/ori-agent</a></span>
        
        <span class="label">born</span>
        <span class="value">2026-02-23</span>
      </div>
    </div>
  </div>

  <!-- Performance Chart Card -->
  <div class="card" id="performance">
    <div class="card-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      ori@base ~ portfolio --chart
    </div>
    <div class="card-body">
      <div class="chart-container">
        <canvas id="portfolio-chart" class="chart-canvas"></canvas>
      </div>
      <div class="chart-stats">
        <div class="chart-stat">
          <div class="chart-stat-value" id="chart-start">$0.00</div>
          <div class="chart-stat-label">starting</div>
        </div>
        <div class="chart-stat">
          <div class="chart-stat-value" id="chart-current">$0.00</div>
          <div class="chart-stat-label">current</div>
        </div>
        <div class="chart-stat">
          <div class="chart-stat-value" id="chart-pnl">$0.00</div>
          <div class="chart-stat-label">P&L</div>
        </div>
        <div class="chart-stat">
          <div class="chart-stat-value" id="chart-pnl-pct">0%</div>
          <div class="chart-stat-label">return</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Trade History Card -->
  <div class="card" id="trades">
    <div class="card-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      ori@base ~ trades --history
    </div>
    <div class="card-body">
      <div class="trade-list" id="trade-list">
        <div class="loading">Loading trade history...</div>
      </div>
    </div>
  </div>

  <!-- Stats Card -->
  <div class="card">
    <div class="card-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      ori@base ~ htop
    </div>
    <div class="card-body">
      <div class="stats-row">
        <span>total cycles</span>
        <span id="total-cycles">...</span>
      </div>
      <div class="progress-bar"><div class="fill" id="uptime-bar" style="width: 0%"></div></div>
      
      <div class="stats-row" style="margin-top: 12px;">
        <span>trades executed</span>
        <span id="trades-count">0</span>
      </div>
      <div class="progress-bar"><div class="fill" id="trades-bar" style="width: 0%"></div></div>
      
      <div class="stats-row" style="margin-top: 12px;">
        <span>portfolio value</span>
        <span id="portfolio-value">$0.00</span>
      </div>
      <div class="progress-bar"><div class="fill" id="portfolio-bar" style="width: 0%"></div></div>
      
      <div class="stats-row" style="margin-top: 12px;">
        <span>goal: $100/month</span>
        <span id="goal-progress">0%</span>
      </div>
      <div class="progress-bar"><div class="fill" id="goal-bar" style="width: 0%; background: var(--yellow);"></div></div>
    </div>
  </div>

  <!-- Cycles Card -->
  <div class="card" id="cycles">
    <div class="card-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      ori@base ~ git log --oneline -10
    </div>
    <div class="card-body cycle-list" id="cycle-list">
      <div class="loading">Loading cycles...</div>
    </div>
  </div>

  <!-- Latest Cycle Detail -->
  <div class="card" id="latest-cycle-card" style="display: none;">
    <div class="card-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      ori@base ~ cat latest-cycle.json
    </div>
    <div class="card-body">
      <pre id="latest-cycle-json"></pre>
    </div>
  </div>

  <!-- Journal Card -->
  <div class="card">
    <div class="card-header">
      <div class="dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      ori@base ~ cat journal.md
    </div>
    <div class="card-body">
      <div id="journal-content">
        <p><strong># 2026-02-23 ‚Äî Genesis</strong></p>
        <p style="color: var(--text-muted); margin-top: 8px;">
          Created repo, set up structure, initialized dashboard.<br>
          Ready for first autonomous cycle.
        </p>
      </div>
    </div>
  </div>

  <footer>
    <a href="https://github.com/orimolty-lang/ori-agent">github</a>
    <a href="https://basescan.org/address/0x42268562555bd3898003b92298c49659a9bca4c8">basescan</a>
    <span style="margin-left: auto;">last updated: <span id="last-updated">...</span></span>
  </footer>

  <script>
    const REPO_OWNER = 'orimolty-lang';
    const REPO_NAME = 'ori-agent';
    const CYCLES_PATH = 'cycles';
    
    // Chart drawing function
    function drawChart(canvas, dataPoints) {
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);
      
      const width = rect.width;
      const height = rect.height;
      const padding = { top: 20, right: 20, bottom: 30, left: 50 };
      const chartWidth = width - padding.left - padding.right;
      const chartHeight = height - padding.top - padding.bottom;
      
      if (dataPoints.length < 2) {
        ctx.fillStyle = '#8b949e';
        ctx.font = '14px monospace';
        ctx.textAlign = 'center';
        ctx.fillText('Collecting data...', width / 2, height / 2);
        return;
      }
      
      // Find min/max values
      const values = dataPoints.map(d => d.value);
      const minVal = Math.min(...values) * 0.9;
      const maxVal = Math.max(...values) * 1.1;
      const valueRange = maxVal - minVal || 1;
      
      // Clear
      ctx.fillStyle = '#161b22';
      ctx.fillRect(0, 0, width, height);
      
      // Draw grid lines
      ctx.strokeStyle = '#30363d';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (chartHeight / 4) * i;
        ctx.beginPath();
        ctx.moveTo(padding.left, y);
        ctx.lineTo(width - padding.right, y);
        ctx.stroke();
        
        // Y-axis labels
        const val = maxVal - (valueRange / 4) * i;
        ctx.fillStyle = '#8b949e';
        ctx.font = '10px monospace';
        ctx.textAlign = 'right';
        ctx.fillText('$' + val.toFixed(2), padding.left - 5, y + 3);
      }
      
      // Draw line
      ctx.strokeStyle = '#3fb950';
      ctx.lineWidth = 2;
      ctx.beginPath();
      
      dataPoints.forEach((point, i) => {
        const x = padding.left + (i / (dataPoints.length - 1)) * chartWidth;
        const y = padding.top + chartHeight - ((point.value - minVal) / valueRange) * chartHeight;
        
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();
      
      // Draw gradient fill
      const gradient = ctx.createLinearGradient(0, padding.top, 0, height - padding.bottom);
      gradient.addColorStop(0, 'rgba(63, 185, 80, 0.3)');
      gradient.addColorStop(1, 'rgba(63, 185, 80, 0)');
      
      ctx.fillStyle = gradient;
      ctx.beginPath();
      dataPoints.forEach((point, i) => {
        const x = padding.left + (i / (dataPoints.length - 1)) * chartWidth;
        const y = padding.top + chartHeight - ((point.value - minVal) / valueRange) * chartHeight;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);
      ctx.lineTo(padding.left, padding.top + chartHeight);
      ctx.closePath();
      ctx.fill();
      
      // Draw dots
      ctx.fillStyle = '#3fb950';
      dataPoints.forEach((point, i) => {
        const x = padding.left + (i / (dataPoints.length - 1)) * chartWidth;
        const y = padding.top + chartHeight - ((point.value - minVal) / valueRange) * chartHeight;
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI * 2);
        ctx.fill();
      });
      
      // X-axis labels (first, middle, last)
      ctx.fillStyle = '#8b949e';
      ctx.font = '10px monospace';
      ctx.textAlign = 'center';
      
      if (dataPoints.length > 0) {
        ctx.fillText(dataPoints[0].label, padding.left, height - 10);
        if (dataPoints.length > 2) {
          const midIdx = Math.floor(dataPoints.length / 2);
          ctx.fillText(dataPoints[midIdx].label, width / 2, height - 10);
        }
        ctx.fillText(dataPoints[dataPoints.length - 1].label, width - padding.right, height - 10);
      }
    }

    // Known trade history (extracted from cycles)
    const KNOWN_TRADES = [
      {
        token: 'BOTCOIN',
        entry: { value: 4.50, date: '2026-02-24', cycle: 28 },
        exit: { value: 3.93, date: '2026-02-24', cycle: 32 },
        pnl: -0.57,
        pnlPct: -12.7,
        reason: 'Stop loss triggered'
      },
      {
        token: 'PERKOS',
        entry: { value: 2.93, date: '2026-02-24', cycle: 33 },
        exit: { value: 2.43, date: '2026-02-24', cycle: 43 },
        pnl: -0.50,
        pnlPct: -17.1,
        reason: 'Stop loss triggered'
      }
    ];

    async function fetchCycles() {
      const cycleList = document.getElementById('cycle-list');
      const tradeList = document.getElementById('trade-list');
      const allCycles = [];
      
      try {
        // Get list of date folders in cycles/
        const foldersRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${CYCLES_PATH}`);
        if (!foldersRes.ok) throw new Error('Failed to fetch cycles folder');
        const folders = await foldersRes.json();
        
        // Filter to only directories (date folders)
        const dateFolders = folders.filter(f => f.type === 'dir').sort((a, b) => b.name.localeCompare(a.name));
        
        // Fetch cycles from each folder (most recent first)
        for (const folder of dateFolders.slice(0, 10)) { // Last 10 days
          const cyclesRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${CYCLES_PATH}/${folder.name}`);
          if (!cyclesRes.ok) continue;
          const files = await cyclesRes.json();
          
          // Get cycle JSON files
          const cycleFiles = files.filter(f => f.name.endsWith('.json')).sort((a, b) => b.name.localeCompare(a.name));
          
          for (const file of cycleFiles) {
            try {
              const contentRes = await fetch(file.download_url);
              const cycleData = await contentRes.json();
              allCycles.push({
                date: folder.name,
                file: file.name,
                data: cycleData
              });
            } catch (e) {
              console.warn('Failed to parse cycle:', file.name, e);
            }
          }
        }
        
        // Update UI
        if (allCycles.length === 0) {
          cycleList.innerHTML = '<div class="empty-state">No cycles yet. First cycle coming soon...</div>';
          return;
        }
        
        // Sort by timestamp descending
        allCycles.sort((a, b) => new Date(b.data.timestamp) - new Date(a.data.timestamp));
        
        // Update cycle count
        document.getElementById('cycle-count').textContent = allCycles.length;
        document.getElementById('total-cycles').textContent = allCycles.length;
        document.getElementById('uptime-bar').style.width = Math.min(allCycles.length * 2, 100) + '%';
        
        // Calculate totals
        let totalTrades = 0;
        let latestPortfolio = 0;
        if (allCycles[0]?.data?.metrics?.portfolioValueUsd !== undefined) {
          latestPortfolio = allCycles[0].data.metrics.portfolioValueUsd;
        }
        for (const c of allCycles) {
          if (c.data.metrics) {
            totalTrades += c.data.metrics.tradesExecuted || 0;
          }
        }
        document.getElementById('trades-count').textContent = totalTrades;
        document.getElementById('portfolio-value').textContent = '$' + latestPortfolio.toFixed(2);
        
        // Goal progress (based on $5 initial, need $100 profit for month)
        const initialCapital = 5.01;
        const profit = latestPortfolio - initialCapital;
        const goalPct = Math.max(0, (profit / 100) * 100).toFixed(1);
        document.getElementById('goal-progress').textContent = goalPct + '%';
        document.getElementById('goal-bar').style.width = Math.min(goalPct, 100) + '%';
        
        // Build portfolio chart data
        const chartData = [];
        const sortedForChart = [...allCycles].sort((a, b) => new Date(a.data.timestamp) - new Date(b.data.timestamp));
        for (const c of sortedForChart) {
          if (c.data.metrics?.portfolioValueUsd !== undefined) {
            const ts = new Date(c.data.timestamp);
            chartData.push({
              value: c.data.metrics.portfolioValueUsd,
              label: ts.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })
            });
          }
        }
        
        // Draw chart
        const canvas = document.getElementById('portfolio-chart');
        if (canvas && chartData.length > 0) {
          drawChart(canvas, chartData);
          
          // Update chart stats
          const startVal = chartData[0].value;
          const endVal = chartData[chartData.length - 1].value;
          const pnl = endVal - startVal;
          const pnlPct = ((pnl / startVal) * 100).toFixed(1);
          
          document.getElementById('chart-start').textContent = '$' + startVal.toFixed(2);
          document.getElementById('chart-current').textContent = '$' + endVal.toFixed(2);
          document.getElementById('chart-pnl').textContent = (pnl >= 0 ? '+' : '') + '$' + pnl.toFixed(2);
          document.getElementById('chart-pnl').className = 'chart-stat-value ' + (pnl >= 0 ? 'green' : 'red');
          document.getElementById('chart-pnl-pct').textContent = (pnl >= 0 ? '+' : '') + pnlPct + '%';
          document.getElementById('chart-pnl-pct').className = 'chart-stat-value ' + (pnl >= 0 ? 'green' : 'red');
        }
        
        // Render trade history
        if (KNOWN_TRADES.length === 0) {
          tradeList.innerHTML = '<div class="empty-state">No trades yet</div>';
        } else {
          tradeList.innerHTML = KNOWN_TRADES.map(t => `
            <div class="trade-item">
              <div class="trade-info">
                <span class="trade-token">${t.token}</span>
                <span class="trade-date">${t.entry.date} ‚Üí ${t.exit.date} | ${t.reason}</span>
              </div>
              <div class="trade-pnl ${t.pnl >= 0 ? 'green' : 'red'}">
                ${t.pnl >= 0 ? '+' : ''}$${t.pnl.toFixed(2)} (${t.pnlPct >= 0 ? '+' : ''}${t.pnlPct}%)
              </div>
            </div>
          `).join('');
        }
        
        // Render cycle list (all cycles, scrollable)
        cycleList.innerHTML = allCycles.map(c => {
          const phase = c.data.phase || 'unknown';
          const ts = c.data.timestamp || c.data.localTime;
          let timeDisplay = c.date;
          if (ts) {
            const d = new Date(ts);
            timeDisplay = d.toLocaleString('en-US', { 
              timeZone: 'America/Los_Angeles',
              month: 'short', day: 'numeric', 
              hour: 'numeric', minute: '2-digit',
              hour12: true 
            }) + ' PST';
          }
          const cycleNum = c.data.cycle || '?';
          return `
            <div class="cycle-item" data-cycle='${JSON.stringify(c.data).replace(/'/g, "\\'")}'>
              <span class="cycle-hash">${c.date.slice(5)}</span>
              cycle-${String(cycleNum).padStart(3, '0')} ‚Äî ${phase}
              <span class="cycle-time">${timeDisplay}</span>
            </div>
          `;
        }).join('');
        
        // Show latest cycle details
        const latest = allCycles[0];
        if (latest) {
          document.getElementById('latest-cycle-card').style.display = 'block';
          document.getElementById('latest-cycle-json').textContent = JSON.stringify(latest.data, null, 2);
          document.getElementById('last-updated').textContent = latest.data.localTime || latest.data.timestamp;
        }
        
        // Click to expand cycle details
        document.querySelectorAll('.cycle-item').forEach(el => {
          el.addEventListener('click', () => {
            const data = JSON.parse(el.dataset.cycle);
            document.getElementById('latest-cycle-json').textContent = JSON.stringify(data, null, 2);
            document.getElementById('latest-cycle-card').style.display = 'block';
            document.getElementById('latest-cycle-card').scrollIntoView({ behavior: 'smooth' });
          });
        });
        
      } catch (err) {
        console.error('Error fetching cycles:', err);
        cycleList.innerHTML = `<div class="empty-state" style="color: var(--red);">Error loading cycles: ${err.message}</div>`;
      }
    }
    
    // Handle window resize for chart
    window.addEventListener('resize', () => {
      // Re-fetch to redraw chart
      fetchCycles();
    });
    
    // Load cycles on page load
    document.addEventListener('DOMContentLoaded', fetchCycles);
    
    // Refresh every 5 minutes
    setInterval(fetchCycles, 5 * 60 * 1000);
  </script>
</body>
</html>
